<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>EF Core (SQL First) :: Programmeren Gevorderd 2 (BETA)</title>
    <meta name="generator" content="Antora 3.1.14">
    <link rel="stylesheet" href="../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="#">Programmeren Gevorderd 2 (BETA)</a>
      <button class="navbar-burger" aria-controls="topbar-nav" aria-expanded="false" aria-label="Toggle main menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
      
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
          <div class="navbar-item has-dropdown is-hoverable">
              <a class="navbar-link" href="#">Producten</a>
              <div class="navbar-dropdown">
                  <a class="navbar-item" target="_blank" href="https://learn.microsoft.com/en-us/cli/azure/">Azure CLI</a>
                  <a class="navbar-item" target="_blank" href="https://www.docker.com/products/docker-desktop">Docker Desktop</a>
                  <a class="navbar-item" target="_blank" href="https://desktop.github.com/download">GitHub Desktop</a>
                  <a class="navbar-item" target="_blank" href="https://www.mysql.com/products/workbench">MySQL Workbench</a>
                  <a class="navbar-item" target="_blank" href="https://www.postman.com/downloads/">Postman</a>
                  <a class="navbar-item" target="_blank" href="https://www.jetbrains.com/rider/download">Rider</a>
                  <a class="navbar-item" target="_blank" href="https://code.visualstudio.com/download">VS Code</a>
              </div>
          </div>
          <div class="navbar-item has-dropdown is-hoverable">
              <a class="navbar-link" href="#">Diensten</a>
              <div class="navbar-dropdown">
                  <a class="navbar-item" target="_blank" href="https://dev.azure.com/hogent-web4-stefancourteaux/">Azure DevOps</a>
                  <a class="navbar-item" target="_blank" href="https://portal.azure.com">Azure Portal</a>
                  <a class="navbar-item" target="_blank" href="https://chamilo.hogent.be">Chamilo</a>
                  <a class="navbar-item" target="_blank" href="https://github.com">GitHub</a>
                  <a class="navbar-item" target="_blank" href="https://jwt.io">JWT.io</a>                  
                  <a class="navbar-item" target="_blank" href="https://dotnet.microsoft.com">MS Docs</a>
              </div>
          </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="pg2" data-version="">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="index.html">Gevorderd 2</a></h3>
<ul class="nav-list">
      <li class="nav-item is-active" data-depth="0">
<ul class="nav-list">
      <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="01-http-apis.html">RESTful HTTP Api</a>
  </li>
      <li class="nav-item is-active" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="02-storefront.html">Backend (Api + EF Core)</a>
<ul class="nav-list">
      <li class="nav-item is-active" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="02-storefront-api.html">RESTful Api</a>
<ul class="nav-list">
      <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="02-storefront-api-1.html">Customers &amp; Products</a>
  </li>
      <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="02-storefront-api-3.html">Orders &amp; Service Layer</a>
  </li>
      <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="02-query-params.html">URL Query ParametersðŸŒŸ</a>
  </li>
</ul>
  </li>
      <li class="nav-item is-active" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="03-storefront-ef.html">Database</a>
<ul class="nav-list">
      <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="03-storefront-ef-1.html">Werken Met MySQL</a>
  </li>
      <li class="nav-item is-active is-current-page" data-depth="3">
    <a class="nav-link" href="03-storefront-ef-2.html">EF Core (SQL First) ðŸŒŸ</a>
  </li>
</ul>
  </li>
      <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="03-storefront-refactoring.html">Refactoring ðŸŒŸ</a>
  </li>
</ul>
  </li>
      <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="04-ef-code-first.html">EF Core (Code First)</a>
  </li>
      <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="05-dapper.html">Dapper Micro ORM</a>
  </li>
      <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="06-async.html">Parallel &amp; Async ðŸŒŸ</a>
  </li>
      <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="07-mongo.html">MongoDB</a>
  </li>
      <li class="nav-item is-active" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="90-oefeningen.html">Oefeningen</a>
<ul class="nav-list">
      <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="90-01-herhaling.html">Herhaling C# en UML</a>
  </li>
      <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="90-03-pokemons.html">Backend (Api + In-Memory)</a>
  </li>
      <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="90-02-backend.html">Backend (Api + EF Core)</a>
  </li>
      <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="90-02-backend-voetbal.html">Backend (Api + EF Core)</a>
  </li>
      <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="90-04-fototoestellen.html">EF Core (Code First)</a>
  </li>
      <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="90-05-backend-dapper.html">Dapper</a>
  </li>
      <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="90-06-mongo.html">Api + MongoDB</a>
  </li>
      <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="90-08-async.html">Async</a>
  </li>
      <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="90-07-alles.html">Cover-All</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Gevorderd 2</span>
    <span class="version"></span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <div class="title"><a href="index.html">Gevorderd 2</a></div>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Gevorderd 2</a></li>
    <li><a href="02-storefront.html">Backend (Api + EF Core)</a></li>
    <li><a href="03-storefront-ef.html">Database</a></li>
    <li><a href="03-storefront-ef-2.html">EF Core (SQL First) ðŸŒŸ</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">EF Core (SQL First)</h1>
<div class="sect1">
<h2 id="_storefront_erd"><a class="anchor" href="#_storefront_erd"></a>StoreFront ERD</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Op het einde van de vorige les, heb je als opdracht een ERD voor de StoreFront applicatie gemaakt. Dit zal er ongeveer zo uitzien. De <strong>veel-op-veel relatie tussen <em>Orders</em> en <em>Products</em></strong>, gefaciliteerd door de <em>tussentabel</em> <em>OrderProducts</em> is van fundamenteel belang.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/storefront-ef/StoreFront.png" alt="StoreFront">
</div>
</div>
<div class="paragraph">
<p>Bovenstaand ERD resulteert in onderstaand script. Dit is manueel geschreven om <em>clutter</em> te minimaliseren, maar een gegenereerd script is ook prima om mee verder te werken.</p>
</div>
<div class="listingblock">
<div class="title">Schema en User voorzien via SQL statements</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">-- Voer uit als root in sys schema
CREATE SCHEMA ShopGent;
CREATE USER 'shopgent' IDENTIFIED BY 'shopgent';
GRANT ALL PRIVILEGES ON ShopGent.* TO 'shopgent';</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Datamodel aanmaken</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">use ShopGent;

drop table if exists OrderProducts;
drop table if exists Orders;
drop table if exists Customers;
drop table if exists Products;

create table Customers (
  Id		   int         auto_increment not null primary key,
  FirstName	   varchar(30)                not null            ,
  LastName	   varchar(30)                not null            ,
  DateOfBirth  datetime	                  not null            ,
  Email        varchar(60)                not null            ,
  TIN          varchar(20)                    null            ,
  AddressLine1 varchar(30)                    null            ,
  AddressLine2 varchar(30)                    null            ,
  AddressLine3 varchar(30)                    null            ,
  Country      varchar(30)                    null
);

create table Products (
  Id		  int		   auto_increment not null primary key,
  Name		  varchar(50)                 not null            ,
  Description varchar(200)                not null            ,
  Price		  decimal(6,2)                not null            ,
  StockCount  int                         not null default 0  ,
  AgeRating   int                             null
);

alter table Products
add constraint UK_Products
unique (Name);

alter table Products
add constraint CK_Products_Price_Positive
check (Price &gt;= 0);

create table Orders (
  Id           int		 auto_increment	not null primary key              ,
  CustomerId   int		                not null                          ,
  CreatedOnUtc timestamp                not null default current_timestamp
);

alter table Orders
add constraint FK_Orders_Customers
foreign key (CustomerId)
references Customers(Id);

create table OrderProducts (
  Id		int          auto_increment not null primary key,
  OrderId	int			                not null            ,
  ProductId	int			                not null            ,
  Quantity	int			                not null            ,
  Price		decimal(6,2)                not null            ,
  Name		varchar(50)	                not null
);

alter table OrderProducts
add constraint FK_OrderProducts_Order
foreign key (OrderId)
references Orders(Id);

alter table OrderProducts
add constraint FK_OrderProducts_Product
foreign key (ProductId)
references Products(Id);

alter table OrderProducts
add constraint CK_OrderProducts_Quantity_Positive
check (Quantity &gt; 0);

alter table OrderProducts
add constraint CK_OrderProducts_Price_Positive
check (Price &gt;= 0);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_entity_framework_core"><a class="anchor" href="#_entity_framework_core"></a>Entity Framework Core</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introductie"><a class="anchor" href="#_introductie"></a>Introductie</h3>
<div class="paragraph">
<p>Nu de database beschikbaar is, zullen we code moeten voorzien om de relationele tabulaire gegevens uit te lezen en deze om te zetten naar C# objecten.</p>
</div>
<div class="paragraph">
<p>Het vak <em>Programmeren Gevorderd</em> heeft je eerder in contact gebracht met de wondere wereld van <a href="https://learn.microsoft.com/en-us/dotnet/framework/data/adonet/ado-net-code-examples"><em>ADO.NET</em></a>. Daar heb je uitgebreid code geschreven om te vertalen tussen objecten en relationele data. Dit process noemen we <em>Object Relational Mapping</em>, of kortweg <em>ORM</em>.</p>
</div>
<div class="paragraph">
<p><em>Entity Framework</em> kan ons hierin bijstaan.</p>
</div>
<div class="quoteblock">
<blockquote>
Entity Framework is a modern object-relation mapper that lets you build a clean, portable, and high-level data access layer with .NET (C#) across a variety of databases, including SQL Database (on-premises and Azure), SQLite, MySQL, PostgreSQL, and Azure Cosmos DB. It supports LINQ queries, change tracking, updates, and schema migrations.
</blockquote>
<div class="attribution">
&#8212; Microsoft<br>
<cite>https://learn.microsoft.com/en-us/ef/</cite>
</div>
</div>
<div class="paragraph">
<p>Dat klinkt veelbelovend! Laten we bekijken wat <em>EF</em> kan betekenen voor de <em>StoreFront</em> applicatie.</p>
</div>
</div>
<div class="sect2">
<h3 id="_scaffolding"><a class="anchor" href="#_scaffolding"></a>Scaffolding</h3>
<div class="paragraph">
<p>De letterlijke vertaling van <em>Scaffolding</em>, los van het IT-vakgebied, is "Steiger" (of "Stelling" in Vlaanderen). Door een stelling te gebruiken bij bouwwerken, kan het beoogde werk (zoals een huis bouwen) vlotter en veiliger verlopen.</p>
</div>
<div class="paragraph">
<p>Wanneer we de term toepassen in IT, doelen we op het (quasi) automatisch genereren van repetitieve, en dus zeer voorspelbare, stukken code. Dit maakt tijd vrij om het beoogde werk (zoals business logica implementeren) vlotter en veiliger te laten verlopen.</p>
</div>
<div class="paragraph">
<p><em>Entity Framework</em> kan voor ons op basis van een bestaande databank een volledige <em>Data Access Layer</em> in C# genereren. Dit wel zeggen dat we geen ADO.Net meer hoeven te schrijven ðŸ¥³</p>
</div>
<div class="paragraph">
<p>Installeer de <code>dotnet-ef</code> tool.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>dotnet tool install --global dotnet-ef</pre>
</div>
</div>
<div class="paragraph">
<p>Voeg een nieuw project <code>Gevorderd2AvondVoorbeeld.Persistence</code> toe aan de bestaande Solution.</p>
</div>
<div class="paragraph">
<p>Voeg hierin onderstaande nuget packages toe. Let er op identieke versies te gebruiken.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Microsoft.EntityFrameworkCore.Design</code></p>
</li>
<li>
<p><code>Pomelo.EntityFrameworkCore.MySql</code> (<a href="https://github.com/PomeloFoundation/Pomelo.EntityFrameworkCore.MySql">GitHub</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Controleer dat je MySQL database <em>up and running</em> is. Bouw een passende <em>Connectionstring</em> op. Respecteer de structuur van onderstaand voorbeeld.</p>
</div>
<div class="literalblock">
<div class="title">ConnectionString</div>
<div class="content">
<pre>"server=127.0.0.1;port=3307;database=schemadag;user=userdag;password=userdag"</pre>
</div>
</div>
<div class="paragraph">
<p>Navigeer in een terminalvenster naar de map waar <code>Gevorderd2AvondVoorbeeld.Persistence.csproj</code> zich bevindt en voer het scaffolding command uit.</p>
</div>
<div class="listingblock">
<div class="title">Scaffolding Command</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-zsh hljs" data-lang="zsh">dotnet ef dbcontext scaffold ` <i class="conum" data-value="1"></i><b>(1)</b>
"server=127.0.0.1;port=3307;database=schemadag;user=userdag;password=userdag" ` <i class="conum" data-value="2"></i><b>(2)</b>
Pomelo.EntityFrameworkCore.MySql ` <i class="conum" data-value="3"></i><b>(3)</b>
--output-dir MijnMapke ` <i class="conum" data-value="4"></i><b>(4)</b>
-t Products ` <i class="conum" data-value="5"></i><b>(5)</b>
-t Customers `
-t Orders `
-t OrderProducts</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Vertel de tool dat je code wil genereren.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><em>ConnectionString</em> naar de database die je wil gebruiken.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Vermeld de gepaste database connector, MySQL in dit geval.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Drop de gegenereerde bestanden in een specifieke folder.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Lijst (optioneel) de specifieke tabellen op die je in scope wil brengen.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Populaire IDE&#8217;s bieden de mogelijkheid om te <em>scaffolden</em> via een rechtsklik, maar zoals altijd is het nuttig om te weten wat er in de achtergrond gebeurt.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Een moment later verschijnen de gegenereerde broncode bestanden in de huidige map.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Wanneer je de files wil opnieuw genereren, bijvoorbeeld na database aanpassingen, kan je het overschrijven afdwingen met de <code>-f</code> optie.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_entities"><a class="anchor" href="#_entities"></a>Entities ðŸŒŸ</h3>
<div class="paragraph">
<p>Op basis van elke tabel wordt een klasse gegenereerd. Dit zijn <em>POCO&#8217;s</em> (Plain Old C# Objects): eenvoudige klassen zonder gedrag. Ze zijn bedoeld om een record uit de relevante tabel voor te stellen in C#. Een record zal in geheugen geladen worden als een instantie van deze klasse.</p>
</div>
<div class="listingblock">
<div class="title">Voorbeeld</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">public partial class Customer <i class="conum" data-value="1"></i><b>(1)</b>
{
    public int Id { get; set; }
    public string FirstName { get; set; } = null!;
    public string LastName { get; set; } = null!;
    public DateTime DateOfBirth { get; set; }
    public string Email { get; set; } = null!;
    public string? Tin { get; set; }
    public string? AddressLine1 { get; set; }
    public string? AddressLine2 { get; set; }
    public string? AddressLine3 { get; set; }
    public string? Country { get; set; }
    public virtual ICollection&lt;Order&gt; Orders { get; set; } = new List&lt;Order&gt;();
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
EF Core genereert <code>partial</code> klassen. Bij compilatie worden alle partial klassen met zelfde naam Ã©n namespace samengevoegd tot Ã©Ã©n geheel, ongeacht in welk bestand ze staan. Op deze manier kan jij de EF klassen uitbreiden met eigen code zonder dat dit werk verloren gaat wanneer je, bijvoorbeeld na datamodelwijzigingen, de <code>entities</code> opnieuw genereert.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_dbcontext"><a class="anchor" href="#_dbcontext"></a>DbContext ðŸŒŸ</h3>
<div class="paragraph">
<p>Verantwoordelijk voor database toegang en beschrijving van data mapping, inclusief relaties.</p>
</div>
<div class="listingblock">
<div class="title">Voorbeeld</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">public partial class StoreFrontDbContext : DbContext
{
    //...
    public virtual DbSet&lt;Customer&gt; Customers { get; set; } <i class="conum" data-value="1"></i><b>(1)</b>
    public virtual DbSet&lt;Order&gt; Orders { get; set; }
    public virtual DbSet&lt;OrderProduct&gt; OrderProducts { get; set; }
    public virtual DbSet&lt;Product&gt; Products { get; set; }

    protected override void OnModelCreating(ModelBuilder modelBuilder)
    {
        modelBuilder.Entity&lt;Customer&gt;(entity =&gt; <i class="conum" data-value="2"></i><b>(2)</b>
        {
            entity.HasKey(e =&gt; e.Id).HasName("PRIMARY");

            entity.Property(e =&gt; e.AddressLine1).HasMaxLength(30);
            entity.Property(e =&gt; e.AddressLine2).HasMaxLength(30);
            entity.Property(e =&gt; e.AddressLine3).HasMaxLength(30);
            entity.Property(e =&gt; e.Country).HasMaxLength(30);
            entity.Property(e =&gt; e.DateOfBirth).HasColumnType("datetime");
            entity.Property(e =&gt; e.Email).HasMaxLength(60);
            entity.Property(e =&gt; e.FirstName).HasMaxLength(30);
            entity.Property(e =&gt; e.LastName).HasMaxLength(30);
            entity.Property(e =&gt; e.Tin)
                .HasMaxLength(20)
                .HasColumnName("TIN");
        });
        //...
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>De <em>DbContext</em> bevat een <em>DbSet&lt;T&gt;</em> voor elke tabel. Een <em>DbSet</em> faciliteert de <em>CRUD</em> operaties.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Het <em>Entity</em> type <em>Customer</em> wordt beschreven. Dit stuurt het <em>ORM</em> gebeuren.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
EF Core genereert altijd <code>virtual</code> properties voor <code>reference types</code>. Zo kan EF Core at runtime de schijnbaar eenvoudige klassen waartegen jij programmeert, vervangen door proxies die de change tracking etc voorzien. Je hoorde misschien al eens van een <em>Proxy Pattern</em>?
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Er valt - uiteraard - <strong>veel</strong> meer te leren over de modelbinding en algemene werking van <em>Entity Framework Core</em>. Op een dag zal je de nood voelen je te verdiepen in bepaalde aspecten van de <a href="https://learn.microsoft.com/en-us/ef/core/">officiÃ«le documentatie</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_gebruik"><a class="anchor" href="#_gebruik"></a>Gebruik</h3>
<div class="paragraph">
<p>De gegenereerde code is onmiddellijk bruikbaar in onze applicatielogica.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">public class OrderService : IOrderService
{
    private readonly StorefrontContext _dbContext;

    public OrderService(StorefrontContext dbContext)
    {
        _dbContext = dbContext;
    }

    public OrderResponseContract GetOrder(int id)
    {
        var order= _dbContext.CustomerOrders.Find(id);
        //...
    }

    public OrderResponseContract CreateOrder(OrderRequestContract orderToCreate)
    {
        var newOrder = new CustomerOrder();
        //...
        _dbContext.CustomerOrders.Add(newOrder);
        _dbContext.SaveChanges();
        //...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Je hoort wel eens zeggen <em>"No such thing as a free lunch"</em>, maar dit komt toch aardig in de buurt.</p>
</div>
</div>
<div class="sect2">
<h3 id="_crud"><a class="anchor" href="#_crud"></a>CRUD ðŸŒŸ</h3>
<div class="paragraph">
<p>De <em>DbSets</em> bieden standaard ondersteuning voor CRUD-operaties.</p>
</div>
<div class="listingblock">
<div class="title">CRUD</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp">// Create
_dbContext.Products.Add(product);
// Read One
var trackedProduct = _dbContext.Products.Find(id);
// Read Multiple
var myList = _dbContext.Products.Where(p =&gt; p.Name.Contains("xyz"));
// Update (via change tracking)
trackedProduct.Price = 2.0;
// Delete
_dbContext.Products.Remove(product);
// Save
_dbContext.SaveChanges(); <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Nodig om <em>CUD</em> operaties te persisteren.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Merk op dat we hier de <code>.Update()</code> methode niet gebruikt hebben. Deze zal immers de volledige entity, alsook alle properties van alle references in scope markeren als changed. Bijgevolg zullen al deze objecten in de database volledig overschreven worden. Dit heeft zijn nut, maar kan gemakkelijk zorgen voor onbedoelde aanpassingen.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_queries"><a class="anchor" href="#_queries"></a>Queries</h3>
<div class="paragraph">
<p><em>Entity Framework</em> vertaalt in de achtergrond de <em>LINQ</em> statements naar <em>SQL</em>.</p>
</div>
<div class="listingblock">
<div class="title">LINQ Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp">var dbProducts = _dbContext.Products
    .Where(p =&gt; p.Name.Contains(nameContains ?? p.Name))
    .Take(resultCount)
    .OrderBy(p =&gt; p.Name);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Je kan de <em>SQL statements</em> lezen in het applicatielog.</p>
</div>
<div class="literalblock">
<div class="title">Logs</div>
<div class="content">
<pre>Microsoft.EntityFrameworkCore.Database.Command[20101]
Executed DbCommand (1ms)
    [
        Parameters=
            [
                @__nameContains_0='?' (Size = 50),
                @__p_1='?' (DbType = Int32)
            ],
            CommandType='Text',
            CommandTimeout='30'
    ]
SELECT  `t`.`Id`,
        `t`.`AgeRating`,
        `t`.`Description`,
        `t`.`Name`,
        `t`.`Price`,
        `t`.`StockCount`
FROM (
    SELECT  `p`.`Id`,
            `p`.`AgeRating`,
            `p`.`Description`,
            `p`.`Name`,
            `p`.`Price`,
            `p`.`StockCount`
    FROM `Products` AS `p`
    WHERE (LOCATE(COALESCE(@__nameContains_0, `p`.`Name`), `p`.`Name`) &gt; 0)
       OR (COALESCE(@__nameContains_0, `p`.`Name`) LIKE '')
    LIMIT @__p_1
) AS `t`
ORDER BY `t`.`Name`</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
De volgorde van je LINQ bouwstenen heeft absoluut impact op de gegeneerde SQL. Wees attent. Eerst ordenen en dan de eerste x records nemen, zal bijvoorbeeld typisch een ander resultaat geven dan eerst x records nemen en die vervolgens te ordenen.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_joins"><a class="anchor" href="#_joins"></a>Joins ðŸŒŸ</h3>
<div class="paragraph">
<p>Je kan gerelateerde <em>Entities</em> in scope brengen met het <em>Include</em> statement.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">var orders = _dbContext.Orders <i class="conum" data-value="1"></i><b>(1)</b>
    .Include(o =&gt; o.Customer) <i class="conum" data-value="2"></i><b>(2)</b>
    .Include(o =&gt; o.OrderProducts) <i class="conum" data-value="2"></i><b>(2)</b>
    .ThenInclude(op =&gt; op.Product); <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Order is leading</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Customer en OrderProducts tabellen worden gejoined op Order</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Product wordt gejoined aan de set via OrderProducts</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using a customized version of the Antora default UI.</p>
  <p>The source code for the default UI is licensed under the terms of the MPL-2.0 license.</p>
    <p>Content by Stefan Courteaux unless otherwise noted. </p>
</footer>
<script id="site-script" src="../_/js/site.js" data-ui-root-path="../_"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
