<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Open Data &amp; Docker Basis :: Programmeren Gevorderd 3 (BETA)</title>
    <meta name="generator" content="Antora 3.1.14">
    <link rel="stylesheet" href="../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="#">Programmeren Gevorderd 3 (BETA)</a>
      <button class="navbar-burger" aria-controls="topbar-nav" aria-expanded="false" aria-label="Toggle main menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
      
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
          <div class="navbar-item has-dropdown is-hoverable">
              <a class="navbar-link" href="#">Producten</a>
              <div class="navbar-dropdown">
                  <a class="navbar-item" target="_blank" href="https://learn.microsoft.com/en-us/cli/azure/">Azure CLI</a>
                  <a class="navbar-item" target="_blank" href="https://www.docker.com/products/docker-desktop">Docker Desktop</a>
                  <a class="navbar-item" target="_blank" href="https://desktop.github.com/download">GitHub Desktop</a>
                  <a class="navbar-item" target="_blank" href="https://www.mysql.com/products/workbench">MySQL Workbench</a>
                  <a class="navbar-item" target="_blank" href="https://www.postman.com/downloads/">Postman</a>
                  <a class="navbar-item" target="_blank" href="https://www.jetbrains.com/rider/download">Rider</a>
                  <a class="navbar-item" target="_blank" href="https://code.visualstudio.com/download">VS Code</a>
              </div>
          </div>
          <div class="navbar-item has-dropdown is-hoverable">
              <a class="navbar-link" href="#">Diensten</a>
              <div class="navbar-dropdown">
                  <a class="navbar-item" target="_blank" href="https://dev.azure.com/hogent-web4-stefancourteaux/">Azure DevOps</a>
                  <a class="navbar-item" target="_blank" href="https://portal.azure.com">Azure Portal</a>
                  <a class="navbar-item" target="_blank" href="https://chamilo.hogent.be">Chamilo</a>
                  <a class="navbar-item" target="_blank" href="https://github.com">GitHub</a>
                  <a class="navbar-item" target="_blank" href="https://jwt.io">JWT.io</a>                  
                  <a class="navbar-item" target="_blank" href="https://dotnet.microsoft.com">MS Docs</a>
              </div>
          </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="pg3" data-version="">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="index.html">Gevorderd 3</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Hoofdstukken üóíÔ∏è</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-cloud-connected.html">Cloud Connected</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-microservices.html">Microservices</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-az-devops.html">Iteratief Ontwikkelen</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="05-cosmos.html">Cosmos &amp; Options Pattern</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="07-blob.html">Blob Storage &amp; PDF</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-middleware.html">Middleware &amp; Extensions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text">Open Data &amp; Docker</span>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="06-02-secret-management.html">Secret Management</a>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text">Testing</span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text">Authenticatie</span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text">Autorisatie</span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text">Afronden</span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="80-lesopnames-2526S2.html">Lesopnames üì∫</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="00-geen-toegang.html">Geen Azure Toegang üò±</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="03-git.html">Git Gebruik ü•≤</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="99-tips.html">Extra Referenties üßê</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Gevorderd 3</span>
    <span class="version"></span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <div class="title"><a href="index.html">Gevorderd 3</a></div>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Gevorderd 3</a></li>
    <li><a href="08-open-data-docker-2526.html">Open Data &amp; Docker Basis</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Open Data &amp; Docker Basis</h1>
<div class="sect1">
<h2 id="_doel_van_deze_les"><a class="anchor" href="#_doel_van_deze_les"></a>Doel van deze les</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Concept Open Data introduceren.</p>
</li>
<li>
<p>Nut en werking van Docker.</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_een_open_data_api_gebruiken"><a class="anchor" href="#_een_open_data_api_gebruiken"></a>Een Open Data Api Gebruiken</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Vaak zal de software die je bouwt gedeeltelijk, of volledig, steunen op api&#8217;s van derde partijen. Bepaalde datasets zijn, al dan niet door de EU verplicht, vrij beschikbaar via api. Dit heet <em>Open Data</em>.</p>
</div>
<div class="paragraph">
<p>Open data kan ook beschikbaar gesteld worden onder de vorm van gestructureerde bestanden of databanken. In dit voorbeeld zullen we een api gebruiken. Het aanroepen van api&#8217;s - of die nu intern, extern, of open data van aard zijn - verloopt technisch altijd op ongeveer dezelfde manier.</p>
</div>
<div class="paragraph">
<p>Doorgaans zullen moderne systemen JSON berichten uitwisselen. Oudere systemen zullen vaak steunen op XML. Naargelang de sector waarin je werkt, kan het zijn dat er andere gestructureerde formaten zoals <a href="https://service.unece.org/trade/untdid/d00a/trmd/coarri_c.htm">UN/EDIFACT</a> gebruikt worden.</p>
</div>
<div class="paragraph">
<p>In dit voorbeeld zullen een Open Data REST api van de Franse overheid gebruiken. De <a href="https://adresse.data.gouv.fr/api-doc/adresse">"API Adresse"</a> laat ons toe een adres in Frankrijk op te zoeken op basis van zeer laxe zoektermen. Daarenboven biedt de api geocoding. Geocoding is het omzetten van een tekstueel adres naar geocoordinaten. Dit kan heel interessant zijn voor een bedrijf dat pakjes levert.</p>
</div>
<div class="paragraph">
<p>We kunnen dit integreren in het ShipIt project. We kunnen bijvoorbeeld controleren of het adres met een zekerheid van <code>&gt;= 0.6</code> gekend is. Adressen met een lagere score verwerpen we. We proberen de url parameters zo veilig mogelijk af te handelen. Het betreft hier immers geen guids, maar wel vrije tekst die spaties en complexe karakters kan bevatten!</p>
</div>
<div class="paragraph">
<p>We maken een klasse aan die het contract van de FR api voorstelt. We nemen enkel de velden op die ons interesseren.</p>
</div>
<div class="listingblock">
<div class="title">ShipIt.Label.Api/AddressResponseContract.cs</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">public class AddressResponseContract
{
    public List&lt;Feature&gt; Features { get; set; }
}

public class Feature{
    public Geometry Geometry { get; set; }
    public Properties Properties { get; set; }
}

public class Geometry
{
    public double[] Coordinates { get; set; }
}

public class Properties
{
    public string Label { get; set; }
    public double Score { get; set; }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We implementeren de conditionele call naar de FR api.</p>
</div>
<div class="listingblock">
<div class="title">ShipIt.Label.Api/Program.cs</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">app.MapPost("api/labels", async (
    IHttpClientFactory clientFactory,
    [FromBody] LabelRequestContract contract,
    IDomainController domain,
    IOptions&lt;LabelApiOptions&gt; options) =&gt; {

    var httpClient = clientFactory.CreateClient();

    // Fetch Price...

    // Validate Address (if FR)
    if(contract.RecipientCountry == "FR")
    {
        // Een set van url query parameters als Key Value
        var query = new Dictionary&lt;string, string&gt;
        {
            { "q", contract.RecipientAddressLine1
                + " " + contract.RecipientAddressLine2 },
            { "limit", "1"}
        };
        // Url encoding van speciale karakters
        var queryString = await new FormUrlEncodedContent(query).ReadAsStringAsync();
        // Url string validatie
        var frUri = new Uri($"{options.Value.FRApiBaseUrl}?{queryString}");

        var addressResponse = await httpClient
            .GetFromJsonAsync&lt;AddressResponseContract&gt;(frUri);

        if(addressResponse.Features[0].Properties.Score &lt; 0.6)
            throw new ArgumentException("Adres lijkt nergens op");
    }

    if(quoteResponse.ValidUntil &lt; DateTime.UtcNow)
        throw new Exception("quote too old.");
    //...
});</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_docker"><a class="anchor" href="#_docker"></a>Docker</h2>
<div class="sectionbody">
<div class="paragraph">
<p>De <a href="https://adresse.data.gouv.fr/api-doc/adresse">"API Adresse"</a> is gratis beschikbaar. Toch kan je niet zomaar onbegrensd gebruik maken van de api. Ze passen rate limiting toe. Een gebruiker mag maximaal 50 oproepen per seconde doen. Ze bieden twee mogelijkheden om deze limiet op te heffen.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Contact opnemen + uitleggen waarom je een hogere limiet nodig hebt.</p>
</li>
<li>
<p>De api zelf hosten in een <em>Docker Container</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We gaan die tweede optie verkennen. <a href="https://www.docker.com/">Docker</a> is een product dat <em>Containerization</em> biedt. Eerst en vooral moeten we begrijpen wat containerzation is en waarom het bestaat. Wij zijn ge√Ønteresseerd in de Docker Image voor de API Adresse, dus we gaan hun documentatie raadplegen om te juiste image te bemachtigen.</p>
</div>
<div class="sect2">
<h3 id="_containerization_wat_en_waarom"><a class="anchor" href="#_containerization_wat_en_waarom"></a>Containerization - Wat en Waarom?</h3>
<div class="paragraph">
<p>Software steunt op de aanwezigheid van externe componenten in het systeem. Voorbeelden van deze dependencies zijn .Net runtime, git, Python, Java runtime, Node etc. Verschillende applicaties kunnen overlappende of botsende dependencies vereisen. Het kan moeilijk worden om al deze afhankelijkheden in kaart te brengen en alle software op eenzelfde installatie van een besturingssysteem werkend te houden. In het slechtste geval kom je terecht in <a href="https://en.wikipedia.org/wiki/Dependency_hell">Dependency Hell</a>.</p>
</div>
<div class="paragraph">
<p>Het zou handiger zijn mocht men applicaties met de gepaste versie van hun dependencies apart van elkaar kunnen installeren in een omgeving die ze niet delen met andere applicaties. Strikt genomen is het al decennia mogelijk dit in te regelen. Denk aan "klassieke" virtualisatieoplossingen zoals VirtualBox, VMWare, KVM, Mainframe LPARS en uiteraard <a href="https://learn.microsoft.com/en-us/virtualization/hyper-v-on-windows/about/">Hyper-V</a>. Deze isoleren een volledige OS installatie, wat hoge systeemeisen met zich meebrengt. Dit heeft zijn nut, maar is overdaad voor de situatie die wij beschouwen - we wensen applicaties te isoleren, niet het volledige OS.</p>
</div>
<div class="paragraph">
<p>Containerization is het <em>lightweight</em> isoleren van een applicatie. Er bestaan verschillende Containerization tools. Docker is er slechts een van en, op dit moment, de populairste. De definitie van de omgeving van een ge√Øsoleerde app is een <em>Image</em>. Een <em>Container</em> is een gedeployde image - al dan niet running.</p>
</div>
<div class="paragraph">
<p>Docker vindt zijn origine in de Linux (server) wereld. Bijgevolg zijn Docker containers standaard op "sandboxing" in Linux gericht. Het is intussen mogelijk om Linux Containers op Windows en Mac te draaien - handig voor (cloud) developers. In dit geval zal de Docker Engine zelf een virtuele machine, met Linux als guest OS, opstarten.</p>
</div>
<div class="paragraph">
<p>Het is strikt genomen mogelijk om Windows en macOS containers te defini√´ren - die vereisen op hun beurt ook een passend OS, al dan niet virtueel.</p>
</div>
</div>
<div class="sect2">
<h3 id="_container_runnen_met_docker_desktop"><a class="anchor" href="#_container_runnen_met_docker_desktop"></a>Container Runnen Met Docker (Desktop)</h3>
<div class="paragraph">
<p><a href="https://www.docker.com/products/docker-desktop/">Download</a> en installeer Docker Desktop.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Accepteer alle standaard instellingen.</p>
</li>
<li>
<p>Kies voor Continue Without Login (tenzij je dat wel wil).</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/open-data-docker/dockerdesktop.png" alt="dockerdesktop">
</div>
</div>
<div class="paragraph">
<p>Images zijn beschikbaar bij verschillende bronnen. De verzameling van offici√´le Docker images is <a href="https://hub.docker.com/search">online</a> beschikbaar. Microsoft biedt ook een register van images, <a href="https://mcr.microsoft.com/en-us/catalog?cat=Databases&amp;alphaSort=asc&amp;alphaSortKey=Name">bijvoorbeeld</a> voor SQL Server.</p>
</div>
<div class="paragraph">
<p>Wij hebben interesse in de image van de Address API, dus we gaan hun <a href="https://github.com/BaseAdresseNationale/addok-docker#installer-une-instance-avec-les-donn%C3%A9es-de-la-base-adresse-nationale">documentatie</a> raadplegen om te zien waar we de image kunnen downloaden.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>https://adresse.data.gouv.fr/data/ban/adresses/latest/addok/addok-france-bundle.zip</pre>
</div>
</div>
<div class="paragraph">
<p>Een app kan ook een samenstelling zijn van meerdere containers, bijvoorbeeld een databank en een api. Wanneer dit het geval is, kan een <em>Compose</em> file gebruikt worden om naar de Docker Engine toe te communiceren wat de bedoeling is. De Adress API gebruikt een kleine compose file.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>https://raw.githubusercontent.com/BaseAdresseNationale/addok-docker/master/docker-compose.yml</pre>
</div>
</div>
<div class="paragraph">
<p>Unzip de image and gebruik de juiste folderstructuur.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>C:\USERS\STEFAN\SOURCE\OPENDATAFRADRESSAPI
‚îÇ   docker-compose.yml
‚îÇ
‚îî‚îÄ‚îÄ‚îÄaddok-data
        addok.conf
        addok.db
        dump.rdb</pre>
</div>
</div>
<div class="paragraph">
<p>Voer docker compose uit.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>docker-compose up</pre>
</div>
</div>
<div class="paragraph">
<p>Indien dit niet werkt, probeer dan expliciet naar de compose file te pointen.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>docker compose -f docker-compose.yml up;</pre>
</div>
</div>
<div class="paragraph">
<p>Wanneer Docker klaar is met de setup, zullen de images verschijnen in de Docker Desktop tool.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/open-data-docker/images.png" alt="images">
</div>
</div>
<div class="paragraph">
<p>Ook de app zal verschijnen bij de containers. We zien dat de app effectief bestaat uit twee containers van een verschillend image.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/open-data-docker/containers.png" alt="containers">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
De gebruikte in-memory database (Redis) vullen kan even duren. Wees geduldig en bekijk de logs. Het RAM verbruik is hoog. Dat is normaal.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_container_app_aanspreken"><a class="anchor" href="#_container_app_aanspreken"></a>Container App Aanspreken</h3>
<div class="paragraph">
<p>We kunnen nu de Open Data api aanroepen op onze eigen computer.</p>
</div>
<div class="literalblock">
<div class="title">Request</div>
<div class="content">
<pre>http://localhost:7878/search?q=1+rue+de+la+paix+paris</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Response</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "type": "FeatureCollection",
    "version": "draft",
    "features": [
        {
            "type": "Feature",
            "geometry": {
                "type": "Point",
                "coordinates": [
                    2.33031,
                    48.868546
                ]
            },
            "properties": {
                "label": "1 Rue de la Paix 75002 Paris",
                "score": 0.9643445454545453,
                "housenumber": "1",
                "id": "75102_6998_00001",
                "name": "1 Rue de la Paix",
                "postcode": "75002",
                "citycode": "75102",
                "x": 650874.19,
                "y": 6863376.95,
                "city": "Paris",
                "district": "Paris 2e Arrondissement",
                "context": "75, Paris, √éle-de-France",
                "type": "housenumber",
                "importance": 0.60779,
                "street": "Rue de la Paix"
            }
        },
	...
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_deployen"><a class="anchor" href="#_deployen"></a>Deployen</h3>
<div class="paragraph">
<p>De label api werd aangepast dus we zouden deze best naar Azure deployen.</p>
</div>
<div class="literalblock">
<div class="title">Label</div>
<div class="content">
<pre>az webapp up `
  --name pg3-shipit-stefanc-label-api `
  --plan pg3-shipit-stefanc-plan `
  --resource-group pg3-shipit-stefanc `
  --location westeurope `
  --os-type linux</pre>
</div>
</div>
<div class="paragraph">
<p><span class="image"><img src="_images/open-data-docker/azure-ok.png" alt="azure ok"></span></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="_images/open-data-docker/azure-nok.png" alt="azure nok"></span></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_docker_compose"><a class="anchor" href="#_docker_compose"></a>Docker Compose</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://github.com/stefan-courteaux/docker-compose-demo">Docker Compose Demo</a> bespreken.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_oefening"><a class="anchor" href="#_oefening"></a>Oefening</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Probeer zelf de taken van deze week te implementeren. Je kan steeds kijken naar de code uit de les als je vast loopt.</p>
</li>
<li>
<p>Informeer je online over gratis/opendata api&#8217;s die nuttig zouden kunnen zijn voor jouw opdracht.</p>
</li>
<li>
<p>Prober zelf een kleine Docker service / compose te maken.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_referenties"><a class="anchor" href="#_referenties"></a>Referenties</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://www.docker.com/">Docker</a></p>
</li>
<li>
<p><a href="https://adresse.data.gouv.fr/api-doc/adresse">Api Adresse</a></p>
</li>
</ul>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
    <p>This page was built using a customized version of the Antora default UI. The source code for the default UI is licensed under the terms of the MPL-2.0 license.</p>
    <p>Course material may *not* be used to teach, tutor, coach, or present without obtaining explicit consent from Stefan Courteaux.</p>
</footer><script id="site-script" src="../_/js/site.js" data-ui-root-path="../_"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
