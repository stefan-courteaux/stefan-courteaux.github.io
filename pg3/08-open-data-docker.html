<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Open Data &amp; Docker Basis :: Programmeren Gevorderd 3 (BETA)</title>
    <meta name="generator" content="Antora 3.1.14">
    <link rel="stylesheet" href="../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="#">Programmeren Gevorderd 3 (BETA)</a>
      <button class="navbar-burger" aria-controls="topbar-nav" aria-expanded="false" aria-label="Toggle main menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
      
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
          <div class="navbar-item has-dropdown is-hoverable">
              <a class="navbar-link" href="#">Producten</a>
              <div class="navbar-dropdown">
                  <a class="navbar-item" target="_blank" href="https://learn.microsoft.com/en-us/cli/azure/">Azure CLI</a>
                  <a class="navbar-item" target="_blank" href="https://www.docker.com/products/docker-desktop">Docker Desktop</a>
                  <a class="navbar-item" target="_blank" href="https://desktop.github.com/download">GitHub Desktop</a>
                  <a class="navbar-item" target="_blank" href="https://www.mysql.com/products/workbench">MySQL Workbench</a>
                  <a class="navbar-item" target="_blank" href="https://www.postman.com/downloads/">Postman</a>
                  <a class="navbar-item" target="_blank" href="https://www.jetbrains.com/rider/download">Rider</a>
                  <a class="navbar-item" target="_blank" href="https://code.visualstudio.com/download">VS Code</a>
              </div>
          </div>
          <div class="navbar-item has-dropdown is-hoverable">
              <a class="navbar-link" href="#">Diensten</a>
              <div class="navbar-dropdown">
                  <a class="navbar-item" target="_blank" href="https://dev.azure.com/hogent-web4-stefancourteaux/">Azure DevOps</a>
                  <a class="navbar-item" target="_blank" href="https://portal.azure.com">Azure Portal</a>
                  <a class="navbar-item" target="_blank" href="https://chamilo.hogent.be">Chamilo</a>
                  <a class="navbar-item" target="_blank" href="https://github.com">GitHub</a>
                  <a class="navbar-item" target="_blank" href="https://jwt.io">JWT.io</a>                  
                  <a class="navbar-item" target="_blank" href="https://dotnet.microsoft.com">MS Docs</a>
              </div>
          </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="pg3" data-version="">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="index.html">Gevorderd 3</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Hoofdstukken üóíÔ∏è</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-cloud-connected.html">Cloud Connected</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-microservices.html">Microservices</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-az-devops.html">Iteratief Ontwikkelen</a>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text">Cosmos</span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text">Blob Storage</span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text">Middleware</span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text">Open Data &amp; Docker</span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text">Secret Management</span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text">Testing</span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text">Authenticatie</span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text">Autorisatie</span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text">Afronden</span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="80-lesopnames-2526S2.html">Lesopnames üì∫</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="00-geen-toegang.html">Geen Azure Toegang üò±</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="03-git.html">Git Gebruik ü•≤</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="99-tips.html">Extra Referenties üßê</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Gevorderd 3</span>
    <span class="version"></span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <div class="title"><a href="index.html">Gevorderd 3</a></div>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Gevorderd 3</a></li>
    <li><a href="08-open-data-docker.html">Open Data &amp; Docker Basis</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Open Data &amp; Docker Basis</h1>
<div class="sect1">
<h2 id="_doel_van_deze_les"><a class="anchor" href="#_doel_van_deze_les"></a>Doel van deze les</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Concept Open Data introduceren.</p>
</li>
<li>
<p>Nut en werking van Docker.</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_een_open_data_api_gebruiken"><a class="anchor" href="#_een_open_data_api_gebruiken"></a>Een Open Data Api Gebruiken</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Vaak zal de software die je bouwt gedeeltelijk, of volledig, steunen op api&#8217;s van derde partijen. Bepaalde datasets zijn, al dan niet door de EU verplicht, vrij beschikbaar via api. Dit heet <em>Open Data</em>.</p>
</div>
<div class="paragraph">
<p>Open data kan ook beschikbaar gesteld worden onder de vorm van gestructureerde bestanden of databanken. In dit voorbeeld zullen we een api gebruiken. Het aanroepen van api&#8217;s - of die nu intern, extern, of open data van aard zijn - verloopt technisch altijd op ongeveer dezelfde manier.</p>
</div>
<div class="paragraph">
<p>Doorgaans zullen moderne systemen JSON berichten uitwisselen. Oudere systemen zullen vaak steunen op XML. Naargelang de sector waarin je werkt, kan het zijn dat er andere gestructureerde formaten zoals <a href="https://service.unece.org/trade/untdid/d00a/trmd/coarri_c.htm">UN/EDIFACT</a> gebruikt worden.</p>
</div>
<div class="paragraph">
<p>In dit voorbeeld zullen een Open Data REST api van de Franse overheid gebruiken. De <a href="https://adresse.data.gouv.fr/api-doc/adresse">"API Adresse"</a> laat ons toe een adres in Frankrijk op te zoeken op basis van zeer laxe zoektermen. Daarenboven biedt de api geocoding. Geocoding is het omzetten van een tekstueel adres naar geocoordinaten. Dit kan heel interessant zijn voor een bedrijf dat pakjes levert.</p>
</div>
<div class="paragraph">
<p>We kunnen dit integreren in het ShipIt project. We kunnen bijvoorbeeld controleren of het adres met een zekerheid van <code>&gt;= 0.6</code> gekend is. Adressen met een lagere score verwerpen we. We proberen de url parameters zo veilig mogelijk af te handelen. Het betreft hier immers geen guids, maar wel vrije tekst die spaties en complexe karakters kan bevatten!</p>
</div>
<div class="paragraph">
<p>We maken een klasse aan die het contract van de FR api voorstelt. We nemen enkel de velden op die ons interesseren.</p>
</div>
<div class="listingblock">
<div class="title">ShipIt.Label.Api/AddressResponseContract.cs</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">public class AddressResponseContract
{
    public List&lt;Feature&gt; Features { get; set; }
}

public class Feature{
    public Geometry Geometry { get; set; }
    public Properties Properties { get; set; }
}

public class Geometry
{
    public double[] Coordinates { get; set; }
}

public class Properties
{
    public string Label { get; set; }
    public double Score { get; set; }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We implementeren de conditionele call naar de FR api.</p>
</div>
<div class="listingblock">
<div class="title">ShipIt.Label.Api/Program.cs</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">app.MapPost("api/labels", async (
    IHttpClientFactory clientFactory,
    [FromBody] LabelRequestContract contract,
    IDomainController domain,
    IOptions&lt;LabelApiOptions&gt; options) =&gt; {

    var httpClient = clientFactory.CreateClient();

    // Fetch Price...

    // Validate Address (if FR)
    if(contract.RecipientCountry == "FR")
    {
        // Een set van url query parameters als Key Value
        var query = new Dictionary&lt;string, string&gt;
        {
            { "q", contract.RecipientAddressLine1
                + " " + contract.RecipientAddressLine2 },
            { "limit", "1"}
        };
        // Url encoding van speciale karakters
        var queryString = await new FormUrlEncodedContent(query).ReadAsStringAsync();
        // Url string validatie
        var frUri = new Uri($"{options.Value.FRApiBaseUrl}?{queryString}");

        var addressResponse = await httpClient
            .GetFromJsonAsync&lt;AddressResponseContract&gt;(frUri);

        if(addressResponse.Features[0].Properties.Score &lt; 0.6)
            throw new ArgumentException("Adres lijkt nergens op");
    }

    if(quoteResponse.ValidUntil &lt; DateTime.UtcNow)
        throw new Exception("quote too old.");
    //...
});</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_docker"><a class="anchor" href="#_docker"></a>Docker</h2>
<div class="sectionbody">
<div class="paragraph">
<p>De <a href="https://adresse.data.gouv.fr/api-doc/adresse">"API Adresse"</a> is gratis beschikbaar. Toch kan je niet zomaar onbegrensd gebruik maken van de api. Ze passen rate limiting toe. Een gebruiker mag maximaal 50 oproepen per seconde doen. Ze bieden twee mogelijkheden om deze limiet op te heffen.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Contact opnemen + uitleggen waarom je een hogere limiet nodig hebt.</p>
</li>
<li>
<p>De api zelf hosten in een <em>Docker Container</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We gaan die tweede optie verkennen. <a href="https://www.docker.com/">Docker</a> is een product dat <em>Containerization</em> biedt. Eerst en vooral moeten we begrijpen wat containerzation is en waarom het bestaat. Wij zijn ge√Ønteresseerd in de Docker Image voor de API Adresse, dus we gaan hun documentatie raadplegen om te juiste image te bemachtigen.</p>
</div>
<div class="sect2">
<h3 id="_containerization_wat_en_waarom"><a class="anchor" href="#_containerization_wat_en_waarom"></a>Containerization - Wat en Waarom?</h3>
<div class="paragraph">
<p>Software steunt op de aanwezigheid van externe componenten in het systeem. Voorbeelden van deze dependencies zijn .Net runtime, git, Python, Java runtime, Node etc. Verschillende applicaties kunnen overlappende of botsende dependencies vereisen. Het kan moeilijk worden om al deze afhankelijkheden in kaart te brengen en alle software op eenzelfde installatie van een besturingssysteem werkend te houden. In het slechtste geval kom je terecht in <a href="https://en.wikipedia.org/wiki/Dependency_hell">Dependency Hell</a>.</p>
</div>
<div class="paragraph">
<p>Het zou handiger zijn mocht men applicaties met de gepaste versie van hun dependencies apart van elkaar kunnen installeren in een omgeving die ze niet delen met andere applicaties. Strikt genomen is het al decennia mogelijk dit in te regelen. Denk aan "klassieke" virtualisatieoplossingen zoals VirtualBox, VMWare, KVM, Mainframe LPARS en uiteraard <a href="https://learn.microsoft.com/en-us/virtualization/hyper-v-on-windows/about/">Hyper-V</a>. Deze isoleren een volledige OS installatie, wat hoge systeemeisen met zich meebrengt. Dit heeft zijn nut, maar is overdaad voor de situatie die wij beschouwen - we wensen applicaties te isoleren, niet het volledige OS.</p>
</div>
<div class="paragraph">
<p>Containerization is het <em>lightweight</em> isoleren van een applicatie. Er bestaan verschillende Containerization tools. Docker is er slechts een van en, op dit moment, de populairste. De definitie van de omgeving van een ge√Øsoleerde app is een <em>Image</em>. Een <em>Container</em> is een gedeployde image - al dan niet running.</p>
</div>
<div class="paragraph">
<p>Docker vindt zijn origine in de Linux (server) wereld. Bijgevolg zijn Docker containers standaard op "sandboxing" in Linux gericht. Het is intussen mogelijk om Linux Containers op Windows en Mac te draaien - handig voor (cloud) developers. In dit geval zal de Docker Engine zelf een virtuele machine, met Linux als guest OS, opstarten.</p>
</div>
<div class="paragraph">
<p>Het is strikt genomen mogelijk om Windows en macOS containers te defini√´ren - die vereisen op hun beurt ook een passend OS, al dan niet virtueel.</p>
</div>
</div>
<div class="sect2">
<h3 id="_container_runnen_met_docker_desktop"><a class="anchor" href="#_container_runnen_met_docker_desktop"></a>Container Runnen Met Docker (Desktop)</h3>
<div class="paragraph">
<p><a href="https://www.docker.com/products/docker-desktop/">Download</a> en installeer Docker Desktop.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Accepteer alle standaard instellingen.</p>
</li>
<li>
<p>Kies voor Continue Without Login (tenzij je dat wel wil).</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/open-data-docker/dockerdesktop.png" alt="dockerdesktop">
</div>
</div>
<div class="paragraph">
<p>Images zijn beschikbaar bij verschillende bronnen. De verzameling van offici√´le Docker images is <a href="https://hub.docker.com/search">online</a> beschikbaar. Microsoft biedt ook een register van images, <a href="https://mcr.microsoft.com/en-us/catalog?cat=Databases&amp;alphaSort=asc&amp;alphaSortKey=Name">bijvoorbeeld</a> voor SQL Server.</p>
</div>
<div class="paragraph">
<p>Wij hebben interesse in de image van de Address API, dus we gaan hun <a href="https://github.com/BaseAdresseNationale/addok-docker#installer-une-instance-avec-les-donn%C3%A9es-de-la-base-adresse-nationale">documentatie</a> raadplegen om te zien waar we de image kunnen downloaden.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>https://adresse.data.gouv.fr/data/ban/adresses/latest/addok/addok-france-bundle.zip</pre>
</div>
</div>
<div class="paragraph">
<p>Een app kan ook een samenstelling zijn van meerdere containers, bijvoorbeeld een databank en een api. Wanneer dit het geval is, kan een <em>Compose</em> file gebruikt worden om naar de Docker Engine toe te communiceren wat de bedoeling is. De Adress API gebruikt een kleine compose file.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>https://raw.githubusercontent.com/BaseAdresseNationale/addok-docker/master/docker-compose.yml</pre>
</div>
</div>
<div class="paragraph">
<p>Unzip de image and gebruik de juiste folderstructuur.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>C:\USERS\STEFAN\SOURCE\OPENDATAFRADRESSAPI
‚îÇ   docker-compose.yml
‚îÇ
‚îî‚îÄ‚îÄ‚îÄaddok-data
        addok.conf
        addok.db
        dump.rdb</pre>
</div>
</div>
<div class="paragraph">
<p>Voer docker compose uit.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>docker-compose up</pre>
</div>
</div>
<div class="paragraph">
<p>Indien dit niet werkt, probeer dan expliciet naar de compose file te pointen.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>docker compose -f docker-compose.yml up;</pre>
</div>
</div>
<div class="paragraph">
<p>Wanneer Docker klaar is met de setup, zullen de images verschijnen in de Docker Desktop tool.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/open-data-docker/images.png" alt="images">
</div>
</div>
<div class="paragraph">
<p>Ook de app zal verschijnen bij de containers. We zien dat de app effectief bestaat uit twee containers van een verschillend image.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/open-data-docker/containers.png" alt="containers">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
De gebruikte in-memory database (Redis) vullen kan even duren. Wees geduldig en bekijk de logs. Het RAM verbruik is hoog. Dat is normaal.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_container_app_aanspreken"><a class="anchor" href="#_container_app_aanspreken"></a>Container App Aanspreken</h3>
<div class="paragraph">
<p>We kunnen nu de Open Data api aanroepen op onze eigen computer.</p>
</div>
<div class="literalblock">
<div class="title">Request</div>
<div class="content">
<pre>http://localhost:7878/search?q=1+rue+de+la+paix+paris</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Response</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "type": "FeatureCollection",
    "version": "draft",
    "features": [
        {
            "type": "Feature",
            "geometry": {
                "type": "Point",
                "coordinates": [
                    2.33031,
                    48.868546
                ]
            },
            "properties": {
                "label": "1 Rue de la Paix 75002 Paris",
                "score": 0.9643445454545453,
                "housenumber": "1",
                "id": "75102_6998_00001",
                "name": "1 Rue de la Paix",
                "postcode": "75002",
                "citycode": "75102",
                "x": 650874.19,
                "y": 6863376.95,
                "city": "Paris",
                "district": "Paris 2e Arrondissement",
                "context": "75, Paris, √éle-de-France",
                "type": "housenumber",
                "importance": 0.60779,
                "street": "Rue de la Paix"
            }
        },
	...
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_deployen"><a class="anchor" href="#_deployen"></a>Deployen</h3>
<div class="paragraph">
<p>De label api werd aangepast dus we zouden deze best naar Azure deployen.</p>
</div>
<div class="literalblock">
<div class="title">Label</div>
<div class="content">
<pre>az webapp up `
  --name pg3-shipit-stefanc-label-api `
  --plan pg3-shipit-stefanc-plan `
  --resource-group pg3-shipit-stefanc `
  --location westeurope `
  --os-type linux</pre>
</div>
</div>
<div class="paragraph">
<p><span class="image"><img src="_images/open-data-docker/azure-ok.png" alt="azure ok"></span></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="_images/open-data-docker/azure-nok.png" alt="azure nok"></span></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_zelf_dockerizen"><a class="anchor" href="#_zelf_dockerizen"></a>Zelf Dockerizen</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_backend"><a class="anchor" href="#_backend"></a>Backend</h3>
<div class="sect3">
<h4 id="_project_maken"><a class="anchor" href="#_project_maken"></a>Project Maken</h4>
<div class="literalblock">
<div class="title">Locatie</div>
<div class="content">
<pre>stefancourteaux@MBP DockerComposeDemo % pwd
/Users/stefancourteaux/Source/PG3Prep/DockerComposeDemo

stefancourteaux@MBP DockerComposeDemo % mkdir backend
stefancourteaux@MBP DockerComposeDemo % cd backend</pre>
</div>
</div>
<div class="literalblock">
<div class="title">Api Maken</div>
<div class="content">
<pre>stefancourteaux@MBP backend % dotnet new web -o MiniApi
The template "ASP.NET Core Empty" was created successfully.

Processing post-creation actions...
Restoring /Users/stefancourteaux/Source/PG3Prep/DockerComposeDemo/backend/MiniApi/MiniApi.csproj:
Restore succeeded.</pre>
</div>
</div>
<div class="literalblock">
<div class="title">Solution (Optioneel)</div>
<div class="content">
<pre>stefancourteaux@MBP backend % dotnet new sln --name Backend
The template "Solution File" was created successfully.

stefancourteaux@MBP backend % dotnet sln add MiniApi/MiniApi.csproj
Project `MiniApi/MiniApi.csproj` added to the solution.</pre>
</div>
</div>
<div class="literalblock">
<div class="title">Project Runnen</div>
<div class="content">
<pre>stefancourteaux@MBP backend % dotnet run --project MiniApi/MiniApi.csproj
Using launch settings from MiniApi/Properties/launchSettings.json...
Building...
info: Microsoft.Hosting.Lifetime[14]
      Now listening on: http://localhost:5021
info: Microsoft.Hosting.Lifetime[0]
      Application started. Press Ctrl+C to shut down.
info: Microsoft.Hosting.Lifetime[0]
      Hosting environment: Development
info: Microsoft.Hosting.Lifetime[0]
      Content root path: /Users/stefancourteaux/Source/PG3Prep/DockerComposeDemo/backend/MiniApi</pre>
</div>
</div>
<div class="literalblock">
<div class="title">Test Run Api</div>
<div class="content">
<pre>stefancourteaux@MBP ~ % curl localhost:5021
Hello World!</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Unieke Responses + CORS (Handig voor straks)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp">var builder = WebApplication.CreateBuilder(args);

builder.Services.AddCors(options =&gt;
{
    options.AddDefaultPolicy(
        policy =&gt;
        {
            policy.SetIsOriginAllowed(origin =&gt;
                new Uri(origin).Host == "localhost"); <i class="conum" data-value="1"></i><b>(1)</b>
        });
});

var app = builder.Build();

app.MapGet("/", () =&gt; $"Hello World! {Guid.NewGuid()}"); <i class="conum" data-value="2"></i><b>(2)</b>

app.UseCors();

app.Run();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Localhost toegelaten ongeacht port/verb etc</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Responses uniek maken</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_dockerizen"><a class="anchor" href="#_dockerizen"></a>Dockerizen</h4>
<div class="literalblock">
<div class="title">Locatie</div>
<div class="content">
<pre>stefancourteaux@MBP MiniApi % pwd
/Users/stefancourteaux/Source/PG3Prep/DockerComposeDemo/backend/MiniApi</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Dockerfile</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-lang="dockerfile">FROM mcr.microsoft.com/dotnet/sdk:9.0 AS build
WORKDIR /App

# Copy everything
COPY . ./
# Restore as distinct layers
RUN dotnet restore
# Build and publish a release
RUN dotnet publish -o out

# Build runtime image
FROM mcr.microsoft.com/dotnet/aspnet:9.0
WORKDIR /App
COPY --from=build /App/out .
ENTRYPOINT ["dotnet", "MiniApi.dll"]</code></pre>
</div>
</div>
<div class="literalblock">
<div class="title">Image Maken</div>
<div class="content">
<pre>stefancourteaux@MBP MiniApi % docker build -t mini-api-image -f Dockerfile .
[+] Building 58.9s (14/14) FINISHED</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>stefancourteaux@MBP MiniApi % docker image ls
REPOSITORY                      TAG    IMAGE ID     CREATED
mini-api-image                  latest 2d92b4e1dfd6 2 minutes ago <i class="conum" data-value="1"></i><b>(1)</b>
mcr.microsoft.com/dotnet/aspnet 9.0    c3aee4ea4f51 2 weeks ago
mysql                           8.0    bf577825b52a 3 months ago</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Daar staat ie dan.</td>
</tr>
</table>
</div>
<div class="literalblock">
<div class="title">Container Runnen (Op Basis Van Image)</div>
<div class="content">
<pre>stefancourteaux@MBP MiniApi % docker run -p 7777:8080 --name api-container mini-api-image <i class="conum" data-value="1"></i><b>(1)</b>
info: Microsoft.Hosting.Lifetime[14]
      Now listening on: http://[::]:8080
      Application started. Press Ctrl+C to shut down.
      Content root path: /App</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>8080 is standaard poort in .net container</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><span class="image"><img src="_images/open-data-docker/demo/container-running.png" alt="container running"></span></p>
</div>
<div class="literalblock">
<div class="content">
<pre>stefancourteaux@MBP MiniApi % curl http://localhost:7777
Hello World! 88f75ce8-97f2-4446-ab5b-1103e5380509%</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_frontend"><a class="anchor" href="#_frontend"></a>Frontend</h3>
<div class="sect3">
<h4 id="_project_maken_2"><a class="anchor" href="#_project_maken_2"></a>Project Maken</h4>
<div class="literalblock">
<div class="title">Locatie</div>
<div class="content">
<pre>stefancourteaux@MBP DockerComposeDemo % pwd
/Users/stefancourteaux/Source/PG3Prep/DockerComposeDemo

stefancourteaux@MBP DockerComposeDemo % ls
backend

stefancourteaux@MBP DockerComposeDemo % mkdir frontend
stefancourteaux@MBP DockerComposeDemo % cd frontend

stefancourteaux@MBP frontend % pwd
/Users/stefancourteaux/Source/PG3Prep/DockerComposeDemo/frontend</pre>
</div>
</div>
<div class="literalblock">
<div class="title">React Project Maken</div>
<div class="content">
<pre>stefancourteaux@@MBP frontend % npm create vite@latest mini-fe -- --template react-ts
&gt; npx
&gt; create-vite mini-fe --template react-ts

Scaffolding project in /Users/stefancourteaux/Source/PG3Prep/DockerComposeDemo/frontend/mini-fe

Done. Now run:

  cd mini-fe
  npm install
  npm run dev</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>stefancourteaux@@MBP frontend % cd mini-fe</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>stefancourteaux@@MBP mini-fe % npm install
added 185 packages, and audited 186 packages in 12s</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>stefancourteaux@@MBP mini-fe % npm run dev
&gt; mini-fe@0.0.0 dev
&gt; vite


  VITE v6.3.2  ready in 839 ms

  ‚ûú  Local:   http://localhost:5173/
  ‚ûú  Network: use --host to expose
  ‚ûú  press h + enter to show help....</pre>
</div>
</div>
<div class="paragraph">
<p><span class="image"><img src="_images/open-data-docker/demo/react-app.png" alt="react app"></span></p>
</div>
<div class="literalblock">
<div class="title">Axios Toevoegen</div>
<div class="content">
<pre>npm install axios</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Api Call Naar Backend</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-typescriptjsx hljs" data-lang="typescriptjsx">import { useState } from 'react'
import axios from 'axios'
import reactLogo from './assets/react.svg'
import viteLogo from '/vite.svg'
import './App.css'

function App() {
  const [miniApiResponse, setResponse] = useState('nog niets ontvangen')


  const fetchData = async () =&gt; {
    try {
      const response = await axios.get('http://localhost:7777');
      setResponse(response.data);
    } catch (error) {
      console.error('MiniApi call mislukt:', error);
    }
  };


  return (
    &lt;&gt;
      &lt;div&gt;
        &lt;a href="https://vite.dev" target="_blank"&gt;
          &lt;img src={viteLogo} className="logo" alt="Vite logo" /&gt;
        &lt;/a&gt;
        &lt;a href="https://react.dev" target="_blank"&gt;
          &lt;img src={reactLogo} className="logo react" alt="React logo" /&gt;
        &lt;/a&gt;
      &lt;/div&gt;
      &lt;h1&gt;Vite + React&lt;/h1&gt;
      &lt;div className="card"&gt;
        &lt;button onClick={fetchData}&gt;
          Laatste api response is {miniApiResponse}
        &lt;/button&gt;
        &lt;p&gt;
          Edit &lt;code&gt;src/App.tsx&lt;/code&gt; and save to test HMR
        &lt;/p&gt;
      &lt;/div&gt;
      &lt;p className="read-the-docs"&gt;
        Click on the Vite and React logos to learn more
      &lt;/p&gt;
    &lt;/&gt;
  )
}

export default App</code></pre>
</div>
</div>
<div class="paragraph">
<p>De react app is nu verbonden met de backend in Docker.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="_images/open-data-docker/demo/react-app-connected.png" alt="react app connected"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="_dockerizen_2"><a class="anchor" href="#_dockerizen_2"></a>Dockerizen</h4>
<div class="literalblock">
<div class="title">Locatie</div>
<div class="content">
<pre>stefancourteaux@@MBP frontend % pwd
/Users/stefancourteaux/Source/PG3Prep/DockerComposeDemo/frontend/mini-fe</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Dockerfile</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-dockerfile hljs" data-lang="dockerfile"># Build Stage
FROM node:lts-alpine AS build
WORKDIR /app
COPY ./package*.json ./
RUN npm install
COPY . .
RUN npm run build

# Production Stage
FROM nginx:stable-alpine AS production
COPY --from=build /app/dist /usr/share/nginx/html
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]</code></pre>
</div>
</div>
<div class="literalblock">
<div class="title">Image Maken</div>
<div class="content">
<pre>stefancourteaux@@MBP mini-fe % docker build -t mini-fe-image -f Dockerfile .</pre>
</div>
</div>
<div class="literalblock">
<div class="title">Container Runnen</div>
<div class="content">
<pre>stefancourteaux@@MBP mini-fe % docker run -p 8008:80 --name fe-container mini-fe-image</pre>
</div>
</div>
<div class="paragraph">
<p>De react app die nu ook uit docker geserved wordt, spreekt met success tegen de api die ook uit docker geserved wordt.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="_images/open-data-docker/demo/react-app-docker.png" alt="react app docker"></span></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_docker_compose"><a class="anchor" href="#_docker_compose"></a>Docker Compose</h3>
<div class="paragraph">
<p>Op dit moment staan front- en backend wel in docker, maar de relatie tussen de 2 containers is niet duidelijk. Wij weten dat ze samen horen, maar docker weet dat niet.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="_images/open-data-docker/demo/docker-duo.png" alt="docker duo"></span></p>
</div>
<div class="paragraph">
<p>We kunnen dit expliciet maken. We kunnen een app samenstellen ofte <em>composen</em> uit meerdere docker images.</p>
</div>
<div class="literalblock">
<div class="title">Locatie</div>
<div class="content">
<pre>stefancourteaux@MBP DockerComposeDemo % pwd
/Users/stefancourteaux/Source/PG3Prep/DockerComposeDemo</pre>
</div>
</div>
<div class="listingblock">
<div class="title">docker-compose.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">version: '3.8'

services:
  mini-api:
    build:
      context: ./backend/MiniApi
      dockerfile: Dockerfile
    ports:
      - "7777:8080"

  mini-fe:
    build:
      context: ./frontend/mini-fe
      dockerfile: Dockerfile
    ports:
      - "8008:80"</code></pre>
</div>
</div>
<div class="literalblock">
<div class="title">Up</div>
<div class="content">
<pre>stefancourteaux@MBP DockerComposeDemo % docker compose up</pre>
</div>
</div>
<div class="paragraph">
<p>Docker weet nu wel dat de containers samen horen.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="_images/open-data-docker/demo/composed-docker.png" alt="composed docker"></span></p>
</div>
<div class="paragraph">
<p>De App werkt nog steeds naar behoren.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="_images/open-data-docker/demo/composed-running.png" alt="composed running"></span></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Je kan uiteraard nog veel complexere scenario&#8217;s opzetten en dieper ingaan op (virtual) networking. Dat ondervind je wel in de praktijk indien je terecht komt in een omgeving waar Docker (intensief) gebruikt wordt. Dat wordt ook stilaan een verhaal voor de collega&#8217;s van <em>Systemen en Netwerken</em>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Dit voorbeeld gebruikt geen cleane React environment settings. Bekijk de aanbevelingen daaromtrent in de cursus <em>Web 3</em>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_azure"><a class="anchor" href="#_azure"></a>Azure</h3>
<div class="paragraph">
<p>Je kan Docker containers hosten in Clouds, ook in Azure. Je kan een enkelvoudige container hosten als <a href="https://learn.microsoft.com/en-us/azure/container-instances/container-instances-quickstart-portal">Container Instance</a> of een schaalbare cluster van containers runnen in een <a href="https://learn.microsoft.com/en-us/azure/aks/what-is-aks">Azure Kubernetes Service</a>.</p>
</div>
<div class="paragraph">
<p><a href="https://kubernetes.io">Kubernetes</a> is g√©√©n Microsoft product. Het is een Open Source product dat door verschillende leveranciers aangeboden wordt.</p>
</div>
<div class="paragraph">
<p>Gezien de lessen gebouwd zijn rond dichte integratie met Azure services, waaronder App Services, gaan we er niet dieper op in.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_oefening"><a class="anchor" href="#_oefening"></a>Oefening</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Probeer zelf de taken van deze week te implementeren. Je kan steeds kijken naar de code uit de les als je vast loopt.</p>
</li>
<li>
<p>Informeer je online over gratis/opendata api&#8217;s die nuttig zouden kunnen zijn voor jouw opdracht.</p>
</li>
<li>
<p>Prober zelf een kleine Docker service / compose te maken.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_referenties"><a class="anchor" href="#_referenties"></a>Referenties</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://www.docker.com/">Docker</a></p>
</li>
<li>
<p><a href="https://adresse.data.gouv.fr/api-doc/adresse">Api Adresse</a></p>
</li>
</ul>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
    <p>This page was built using a customized version of the Antora default UI. The source code for the default UI is licensed under the terms of the MPL-2.0 license.</p>
    <p>Course material may *not* be used to teach, tutor, coach, or present without obtaining explicit consent from Stefan Courteaux.</p>
</footer><script id="site-script" src="../_/js/site.js" data-ui-root-path="../_"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
